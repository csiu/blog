---
title: "STAT545 enrollment"
author: "csiu"
date: "September 25, 2015"
output:
    html_document:
        keep_md: yes
---
```{r img-setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(fig.align='center')
```

As part of my education in graduate school, I'm enrolled in [STAT 545A: Exploratory Data Analysis](https://stat545-ubc.github.io). Here we learn data wrangling, exploration, and analysis with R.

```{r, echo=FALSE}
library(tidyr)
library(ggplot2)
library(grid)
library(plyr)

# setwd('_drafts/2015-09-25-stat545-enrollment/')
data <- read.delim('data/2015_STAT545_enrollment.csv', sep=",")
```

The instructor, [\@JennyBryan](https://twitter.com/JennyBryan), recently compiled a CSV of [enrollment in STAT 545A in 2015 by degree and program](https://gist.github.com/jennybc/924fe242a31e0239762f#file-2015_stat545_enrollment-csv). And I decided to do some exploration of this data. Pictorially (in a heatmap), the raw data looks like the following: 

### Statistics, statistics, statistics
```{r, echo=FALSE, dev="png", dpi=340, out.width="604px"}
databysubject <- gather(data, Program, Count, -Subject)
ggplot(subset(databysubject, subset = (databysubject$Program != "Total")),
       aes(y=Subject, x=Program, fill=Count, label=Count)) +
  geom_tile(color="grey70") +
  geom_text(color="white") +
  xlab("") +
  ylab("") +
  scale_fill_gradient(low="white", high="blue") +
  #scale_y_discrete(limits = rev(levels(data$Subject))) +
  scale_y_discrete(limits = rev(as.character(data$Subject))) +
  guides(fill=FALSE) +
  theme(panel.background = element_blank(),
        panel.border = element_blank(),
        panel.grid.major = element_blank(),
        axis.ticks.margin = unit(c(0.1,-1), 'lines'),
        axis.ticks = element_line(colour="grey90"),
        axis.text = element_text(colour="black")
        )
```

This heatmap, orded by number of students per program, shows that most students taking this course belong to Statistics. This doesn't come as too much of surprise since the course is provided by the Statistics department e.g. **STAT** 545A. As a Bioinformatics student, we are representing third place.

### Mostly Masters students
```{r, echo=FALSE, dev="png", dpi=140, out.width="540px"}
databyprogram <- data.frame(Count=colSums(data[,c("BSC", "Masters", "PHD")]))
ggplot(databyprogram,
       aes(x=rownames(databyprogram), y=Count, label=Count)) +
  geom_bar(stat="identity") +
  geom_text(vjust=-0.4) +
  ylim(0, 41) +
  xlab("") +
  ylab("Number of students") +
  theme(panel.grid.major.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank()
        )
```

Looking at the data differently, we see that there is twice as many Masters students than PHD students. There is also 20x more Masters students than BSC students. STAT 545 is a graduate course, so it makes sense there is less BSC students.

## Other figures
```{r, echo=FALSE, dev="png", dpi=140, out.width="540px"}
dnormS <- with(data, 
              cbind(Subject, 
                    data[,c("BSC", "Masters", "PHD")] / Total))
ord <- hclust(dist(data.frame(dnormS[,c("BSC", "Masters", "PHD")]), 
                   method="euclidean"),
              method="ward.D")$order

datanorm <- gather(dnormS, Program, Count, -Subject)

ggplot(datanorm, aes(x=Subject, y=Count, fill=Program)) +
  geom_bar(stat="identity") + 
  scale_x_discrete(limits = as.character(data$Subject)[ord]) +
  xlab("") +
  ylab("") +
  coord_flip() #+ theme(legend.position="top")
```


```{r, echo=FALSE, dev="png", dpi=140, out.width="540px", fig.height=6.5}
datanormP <- t(data[,c("BSC", "Masters", "PHD")])
datanormP <- datanormP / rowSums(datanormP)

colnames(datanormP) <- data$Subject
datanormP <- data.frame(Program=rownames(datanormP), datanormP)
datanormP <- datanormP[, order(names(datanormP), decreasing=TRUE)]

datanormP <- gather(datanormP, Program)
colnames(datanormP) <- c("Program", "Subject", "Value")

ggplot(datanormP, aes(x=Program, y=Value, fill=Subject)) +
  geom_bar(stat="identity", color="black") + 
  xlab("") +
  ylab("Subject proportion") + 
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(axis.text.y = element_blank())
```

----

## Past

Also provided is [STAT 545 enrollment data from the past](https://github.com/STAT545-UBC/STAT545-UBC.github.io/blob/master/course-admin/history/STAT545-registered-students-all-time-anonymized.csv)

```{r, echo=FALSE}
pastdata <- read.delim('data/STAT545-registered-students-all-time-anonymized.csv', 
                       sep=',', na.strings="")

pastdata$Program <- factor(pastdata$Program, exclude=NULL)
pastdata$year <- as.factor(pastdata$year)
```

```{r, echo=FALSE, dev="png", dpi=140, out.width="540px"}
ggplot(pastdata, aes(x=year, color=Gender)) + 
  geom_bar() + 
  xlab("") + 
  ylab("Number of enrolled students") +
  scale_color_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(panel.grid.major.x = element_blank())
```

### Enrollment by gender

```{r echo=FALSE, dev="png", dpi=340, out.width="650px", fig.width=10, fig.height=7, warning=FALSE}
ggplot(pastdata, aes(x=Program, fill=Gender)) +
  geom_bar(subset=.(Gender=="Female")) +
  geom_bar(subset=.(Gender=="Male"), aes(y = ..count.. * (-1))) +
  scale_x_discrete(limits = rev(names(sort(table(pastdata$Program)))) ) + 
  scale_y_continuous(breaks=seq(-60,40,10), labels=abs(seq(-60,40,10))) +
  xlab("") +
  ylab("Enrollment by gender") +
  coord_flip() +
  theme(
    axis.text.y = element_text(colour="black")
  )
```

